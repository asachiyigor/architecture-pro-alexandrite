---
up:
  - "[[Task3]]"
---
# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –≤ —Å–∏—Å—Ç–µ–º—É "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—Ç"

## 1. –ú–æ—Ç–∏–≤–∞—Ü–∏—è

### 1.1 –ü—Ä–æ–±–ª–µ–º—ã —Å–∏—Å—Ç–µ–º—ã

–ö–æ–º–ø–∞–Ω–∏—è "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—Ç" —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ:

- **–ü–æ—Ç–µ—Ä—è –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ RabbitMQ** - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∫–≤–æ–∑–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–≤–∏–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏
- **–î–æ–ª–≥–∏–π —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (2-30 –º–∏–Ω—É—Ç)** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –≤ —Ü–µ–ø–æ—á–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞ MES** - –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è bottleneck

### 1.2 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

–í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –ø–æ–∑–≤–æ–ª–∏—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:

1. **Latency –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º** - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫–∞–∂–¥—ã–º —Å–µ—Ä–≤–∏—Å–æ–º –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
   - –ü—Ä–∏–º–µ—Ä: –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ Shop ‚Üí RabbitMQ ‚Üí CRM ‚Üí MES
   - –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: < 200ms –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

2. **–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö spans** - –¥–æ–ª—è –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ–±—â–µ–º –ø–æ—Ç–æ–∫–µ
   - –ü–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Ç–µ—Ä—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ RabbitMQ)
   - –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: < 0.1% –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

3. **–ì–ª—É–±–∏–Ω–∞ –≤—ã–∑–æ–≤–æ–≤ (span depth)** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –í—ã—è–≤–ª—è–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: < 10 —É—Ä–æ–≤–Ω–µ–π –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

4. **–ü—Ä–æ—Ü–µ–Ω—Ç —Ç—Ä–µ–π—Å–æ–≤ —Å –∞–Ω–æ–º–∞–ª—å–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é** - –≤—ã–±—Ä–æ—Å –∑–∞ 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å
   - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
   - –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç –ø—Ä–∏ > 5%

### 1.3 –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

1. **Customer Journey Time** - –ø–æ–ª–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
   - –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è B2B –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∂–µ—Å—Ç–∫–∏–º–∏ SLA
   - –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: < 5 –º–∏–Ω—É—Ç –¥–ª—è 95% –∑–∞–∫–∞–∑–æ–≤

2. **Order Loss Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
   - –ü—Ä—è–º–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤—ã—Ä—É—á–∫—É –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—é
   - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ, —Ü–µ–ª–µ–≤–æ–µ: 0%

3. **MTTR (Mean Time To Recovery)** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
   - –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å —á–∞—Å–æ–≤ –¥–æ –º–∏–Ω—É—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è –±—ã—Å—Ç—Ä–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã
   - –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: < 15 –º–∏–Ω—É—Ç

### 1.4 –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: –í–´–°–û–ö–ê–Ø**

–ü–æ—Ç–µ—Ä—è –∑–∞–∫–∞–∑–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã—Ä—É—á–∫—É. –ë–µ–∑ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ:
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ —Ç–µ—Ä—è—é—Ç—Å—è –∑–∞–∫–∞–∑—ã
- –ü–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –¥–æ 30 –º–∏–Ω—É—Ç
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –¥–∞—à–±–æ—Ä–¥–∞ MES

---

## 2. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 2.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å—Ç–µ–∫

**OpenTelemetry + Jaeger**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**
- **OpenTelemetry** - vendor-agnostic —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å vendor lock-in
- **Jaeger** - –∑—Ä–µ–ª–æ–µ open-source —Ä–µ—à–µ–Ω–∏–µ —Å –Ω–∏–∑–∫–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –≤–ª–∞–¥–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Java (SpringBoot), C# (.NET), JavaScript (Vue/React)
- –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RabbitMQ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç-–ø—Ä–æ–ø–∞–≥–∞—Ü–∏—é

### 2.2 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Application Layer                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ   Shop   ‚îÇ  ‚îÇ   CRM    ‚îÇ  ‚îÇ   MES    ‚îÇ  ‚îÇ RabbitMQ ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ (Spring) ‚îÇ  ‚îÇ (Spring) ‚îÇ  ‚îÇ  (C#)    ‚îÇ  ‚îÇ          ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ       ‚îÇ             ‚îÇ             ‚îÇ             ‚îÇ          ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ              ‚ñº             ‚ñº                               ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ     ‚îÇ  OpenTelemetry SDK / Agent      ‚îÇ                    ‚îÇ
‚îÇ     ‚îÇ  - Auto-instrumentation         ‚îÇ                    ‚îÇ
‚îÇ     ‚îÇ  - Context Propagation          ‚îÇ                    ‚îÇ
‚îÇ     ‚îÇ  - Sampling (head-based)        ‚îÇ                    ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  Jaeger Collector     ‚îÇ
        ‚îÇ  - Validates traces   ‚îÇ
        ‚îÇ  - Enriches metadata  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  Storage Backend      ‚îÇ
        ‚îÇ  - Cassandra/         ‚îÇ
        ‚îÇ    Elasticsearch      ‚îÇ
        ‚îÇ  - Retention: 30d     ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   Jaeger Query UI     ‚îÇ
        ‚îÇ - Trace visualization ‚îÇ
        ‚îÇ - Dependency graph    ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.3 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### 2.3.1 OpenTelemetry SDK

**SpringBoot (Shop, CRM):**
```yaml
# application.yml
otel:
  service:
    name: alexandrite-shop
  traces:
    exporter: jaeger
  exporter:
    jaeger:
      endpoint: http://jaeger-collector:14250
  resource:
    attributes:
      deployment.environment: production
      service.version: ${APP_VERSION}
```

**C# MES:**
```csharp
// Program.cs
services.AddOpenTelemetry()
    .WithTracing(builder => builder
        .AddAspNetCoreInstrumentation()
        .AddHttpClientInstrumentation()
        .AddEntityFrameworkCoreInstrumentation()
        .AddJaegerExporter(options => {
            options.Endpoint = new Uri("http://jaeger-collector:14250");
        })
    );
```

**RabbitMQ Context Propagation:**
```java
// SpringBoot Producer
Map<String, Object> headers = new HashMap<>();
W3CTraceContextPropagator.getInstance()
    .inject(Context.current(), headers, setter);

rabbitTemplate.convertAndSend(exchange, routingKey, message,
    msg -> {
        headers.forEach((k, v) ->
            msg.getMessageProperties().setHeader(k, v));
        return msg;
    });
```

#### 2.3.2 Sampling Strategy

**Head-based sampling** (–Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):

```yaml
# Probabilistic sampler –¥–ª—è production
sampler:
  type: probabilistic
  param: 0.1  # 10% –≤—Å–µ—Ö —Ç—Ä–µ–π—Å–æ–≤

# Always-on –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
sampler:
  type: parent_based
  param:
    - always_on: /api/orders/create
    - always_on: /api/orders/calculate-cost
```

–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: 10% sampling –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ overhead –Ω–∞ 90%.

#### 2.3.3 Jaeger Infrastructure

**Deployment:**
```yaml
# docker-compose.yml
version: '3.8'
services:
  jaeger:
    image: jaegertracing/all-in-one:1.52
    environment:
      - COLLECTOR_OTLP_ENABLED=true
      - SPAN_STORAGE_TYPE=elasticsearch
      - ES_SERVER_URLS=http://elasticsearch:9200
    ports:
      - "16686:16686"  # UI
      - "14250:14250"  # gRPC collector
      - "4317:4317"    # OTLP gRPC

  elasticsearch:
    image: elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms2g -Xmx2g"
    volumes:
      - jaeger-es-data:/usr/share/elasticsearch/data
```

**Retention Policy:** 30 –¥–Ω–µ–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–µ–π—Å–æ–≤ –≤ Elasticsearch.

### 2.4 –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è C4 –¥–∏–∞–≥—Ä–∞–º–º–∞ (Container level)

**üìä –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞:**
- –ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª: **`jewerly_c4_model.drawio`**
- PNG –≤–µ—Ä—Å–∏—è: **`jewerly_c4_model.png`**

–î–∏–∞–≥—Ä–∞–º–º–∞ –±—ã–ª–∞ –¥–æ–ø–æ–ª–Ω–µ–Ω–∞ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ (–≤—ã–¥–µ–ª–µ–Ω—ã **–∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º** –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–µ–≤—å—é):

#### –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Observability Stack:

1. **OpenTelemetry Collector**
   - –¢–∏–ø: Container (OTel Collector)
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –°–æ–±–∏—Ä–∞–µ—Ç —Ç—Ä–µ–π—Å—ã –æ—Ç –≤—Å–µ—Ö backend-—Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –∏—Ö –≤ Jaeger
   - –ü—Ä–æ—Ç–æ–∫–æ–ª—ã: gRPC (–ø–æ—Ä—Ç 14250), OTLP (–ø–æ—Ä—Ç 4317)
   - –§—É–Ω–∫—Ü–∏–∏: –ë–∞—Ç—á–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è, context propagation

2. **Jaeger Collector**
   - –¢–∏–ø: Container (Jaeger)
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –æ–±–æ–≥–∞—â–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–π—Å–æ–≤
   - –§—É–Ω–∫—Ü–∏–∏:
     - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è trace data
     - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ deployment environment –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
     - Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ñ–ª—É–¥–∞

3. **Elasticsearch**
   - –¢–∏–ø: Database (Elasticsearch)
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ç—Ä–µ–π—Å–æ–≤
   - Retention: 30 –¥–Ω–µ–π
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: Single-node –¥–ª—è pilot, –∫–ª–∞—Å—Ç–µ—Ä –¥–ª—è production

4. **Jaeger UI**
   - –¢–∏–ø: Container (Jaeger Query)
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–π—Å–æ–≤ –∏ –≥—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –§—É–Ω–∫—Ü–∏–∏:
     - –ü–æ–∏—Å–∫ —Ç—Ä–µ–π—Å–æ–≤ –ø–æ service, operation, tags
     - Dependency graph –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
     - Latency analysis –∏ error tracking
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ VPN + –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### –ù–æ–≤—ã–µ —Å–≤—è–∑–∏ (–∫—Ä–∞—Å–Ω—ã–µ –ø—É–Ω–∫—Ç–∏—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ):

| –û—Ç                | –ö                         | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|-------------------|---------------------------|---------------------------------------------|
| Shop API          | OpenTelemetry Collector   | –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–µ–π—Å–æ–≤ —á–µ—Ä–µ–∑ OTel Java SDK        |
| CRM API           | OpenTelemetry Collector   | –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–µ–π—Å–æ–≤ —á–µ—Ä–µ–∑ OTel Java SDK        |
| MES API           | OpenTelemetry Collector   | –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–µ–π—Å–æ–≤ —á–µ—Ä–µ–∑ OTel .NET SDK        |
| OTel Collector    | Jaeger Collector          | –ü–µ—Ä–µ—Å—ã–ª–∫–∞ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–π—Å–æ–≤ (gRPC)     |
| Jaeger Collector  | Elasticsearch             | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–µ–π—Å–æ–≤ –≤ storage                |
| Elasticsearch     | Jaeger UI                 | –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞  |

#### –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- ‚úÖ **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö backend-—Å–µ—Ä–≤–∏—Å–æ–≤**: Shop API, CRM API, MES API —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ç—Ä–µ–π—Å—ã —á–µ—Ä–µ–∑ OpenTelemetry SDK
- ‚úÖ **Context Propagation —á–µ—Ä–µ–∑ RabbitMQ**: –ü–µ—Ä–µ–¥–∞—á–∞ traceparent header –ø–æ W3C Trace Context —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä**: OpenTelemetry Collector –∫–∞–∫ –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–∏–µ–º–∞ —Ç—Ä–µ–π—Å–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –±–∞—Ç—á–∏–Ω–≥–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**: Elasticsearch –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –∏ retention management
- ‚úÖ **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏**: Jaeger UI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—É—é –≤–∏–¥–∏–º–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ dependency graph

### 2.5 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ span'—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. **Order Creation Flow:**
   - `POST /api/orders` (Shop)
   - `rabbitmq.publish` ‚Üí `orders.created`
   - `rabbitmq.consume` (CRM)
   - `POST /crm/orders/validate`
   - `rabbitmq.publish` ‚Üí `orders.validated`
   - `rabbitmq.consume` (MES)

2. **Cost Calculation Flow:**
   - `POST /api/orders/calculate-cost`
   - Database queries (N+1 detection)
   - External service calls (–µ—Å–ª–∏ –µ—Å—Ç—å)

3. **MES Dashboard Load:**
   - `GET /api/dashboard`
   - PostgreSQL queries
   - S3 file fetches

### 2.6 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥

**üìä –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
- –ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª: **`jewerly_c4_model.drawio`**
- PNG –≤–µ—Ä—Å–∏—è: **`jewerly_c4_model.png`**

–ù–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–≤—ã–¥–µ–ª–µ–Ω—ã **–∑–µ–ª–µ–Ω—ã–º —Ü–≤–µ—Ç–æ–º**):
- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏–∑ Jaeger –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –¥–∞—à–±–æ—Ä–¥—ã
- **AlertManager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞–º–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- **Monitoring Stack** - –≥—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### 2.6.1 Service Level Indicators (SLI)

```yaml
# Prometheus rules –Ω–∞ –æ—Å–Ω–æ–≤–µ Jaeger metrics
groups:
  - name: order_journey_sli
    interval: 30s
    rules:
      # Latency: 95% –∑–∞–∫–∞–∑–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è < 5 –º–∏–Ω—É—Ç
      - record: order_journey:duration:p95
        expr: |
          histogram_quantile(0.95,
            sum(rate(jaeger_trace_duration_bucket{
              service="alexandrite-shop",
              operation="POST /api/orders"
            }[5m])) by (le)
          )

      # Availability: 99.5% —Ç—Ä–µ–π—Å–æ–≤ –±–µ–∑ –æ—à–∏–±–æ–∫
      - record: order_journey:success_rate
        expr: |
          sum(rate(jaeger_spans_finished_total{
            service=~"alexandrite-.*",
            error="false"
          }[5m]))
          /
          sum(rate(jaeger_spans_finished_total{
            service=~"alexandrite-.*"
          }[5m]))

      # Throughput: –∫–æ–ª-–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤/–º–∏–Ω
      - record: order_journey:throughput
        expr: |
          sum(rate(jaeger_spans_finished_total{
            service="alexandrite-shop",
            operation="POST /api/orders",
            error="false"
          }[1m])) * 60
```

#### 2.6.2 –ê–ª–µ—Ä—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ SLI

```yaml
# AlertManager rules
groups:
  - name: order_journey_alerts
    rules:
      # –ù–∞—Ä—É—à–µ–Ω–∏–µ SLO –ø–æ latency
      - alert: OrderJourneyLatencyHigh
        expr: order_journey:duration:p95 > 300  # 5 –º–∏–Ω—É—Ç
        for: 5m
        labels:
          severity: critical
          component: order-processing
        annotations:
          summary: "95% –∑–∞–∫–∞–∑–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è > 5 –º–∏–Ω—É—Ç"
          description: |
            –¢–µ–∫—É—â–∏–π p95: {{ $value }}s
            Dashboard: http://jaeger/search?service=alexandrite-shop

      # –ü–∞–¥–µ–Ω–∏–µ success rate
      - alert: OrderJourneySuccessRateLow
        expr: order_journey:success_rate < 0.995
        for: 2m
        labels:
          severity: critical
          component: order-processing
        annotations:
          summary: "Success rate –∑–∞–∫–∞–∑–æ–≤ < 99.5%"
          description: |
            –¢–µ–∫—É—â–∏–π success rate: {{ $value | humanizePercentage }}
            –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ RabbitMQ

      # –ê–Ω–æ–º–∞–ª–∏–∏ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ latency
      - alert: OrderJourneyLatencyAnomaly
        expr: |
          (
            order_journey:duration:p95
            /
            order_journey:duration:p95 offset 1h
          ) > 2
        for: 3m
        labels:
          severity: warning
          component: order-processing
        annotations:
          summary: "Latency –≤—ã—Ä–æ—Å –≤ 2+ —Ä–∞–∑–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å"
          description: "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Jaeger UI"
```

#### 2.6.3 Dashboards –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

**Grafana Dashboard: Order Journey Monitoring**

```json
{
  "dashboard": {
    "title": "Order Journey - End-to-End Monitoring",
    "panels": [
      {
        "title": "Order Processing Pipeline",
        "type": "graph",
        "targets": [
          {
            "expr": "order_journey:duration:p95",
            "legendFormat": "p95 latency"
          },
          {
            "expr": "order_journey:duration:p50",
            "legendFormat": "p50 latency"
          }
        ]
      },
      {
        "title": "Success Rate",
        "type": "gauge",
        "targets": [
          {
            "expr": "order_journey:success_rate * 100"
          }
        ],
        "thresholds": [
          { "value": 99.5, "color": "green" },
          { "value": 99.0, "color": "yellow" },
          { "value": 0, "color": "red" }
        ]
      },
      {
        "title": "Throughput",
        "type": "graph",
        "targets": [
          {
            "expr": "order_journey:throughput",
            "legendFormat": "Orders/min"
          }
        ]
      },
      {
        "title": "Error Rate by Service",
        "type": "heatmap",
        "targets": [
          {
            "expr": "sum(rate(jaeger_spans_finished_total{error=\"true\"}[5m])) by (service)"
          }
        ]
      }
    ]
  }
}
```

#### 2.6.4 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

1. **Jaeger ‚Üí Prometheus**: Jaeger Collector —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –æ —Ç—Ä–µ–π—Å–∞—Ö (latency, error rate, throughput)
2. **Prometheus ‚Üí Grafana**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ –¥–∞—à–±–æ—Ä–¥—ã —Å SLI/SLO
3. **Prometheus ‚Üí AlertManager**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç–∏–Ω–≥ –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ SLO
4. **AlertManager ‚Üí Slack/Email**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus scrape:**

```yaml
scrape_configs:
  - job_name: 'jaeger-collector'
    static_configs:
      - targets: ['jaeger-collector:14269']
    scrape_interval: 15s

  - job_name: 'alexandrite-services'
    static_configs:
      - targets:
        - 'shop-api:8080'
        - 'crm-api:8080'
        - 'mes-api:5000'
    scrape_interval: 30s
```

---

## 3. –ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã

### 3.1 –ö–æ–≥–¥–∞ —Ç—Ä–µ–π—Å–∏–Ω–≥ –ù–ï –ø—Ä–∏–Ω–µ—Å–µ—Ç –ø–æ–ª—å–∑—ã

1. **–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π**
   - –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤
   - –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è (JProfiler, dotTrace)

2. **Batch-–ø—Ä–æ—Ü–µ—Å—Å—ã –±–µ–∑ latency-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**
   - –ù–æ—á–Ω—ã–µ ETL-–¥–∂–æ–±—ã, –≥–¥–µ –≤–∞–∂–Ω–∞ throughput, –∞ –Ω–µ latency
   - –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (Prometheus) –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–°–∏—Å—Ç–µ–º—ã —Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏**
   - –ï—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø—É—Ç—å –±–µ–∑ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - Overhead —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –Ω–µ –æ–∫—É–ø–∞–µ—Ç—Å—è

4. **–ù–∏–∑–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã**
   - < 10 RPS, –≥–¥–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ª–µ–≥–∫–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
   - –¢—Ä–µ–π—Å–∏–Ω–≥ –±—É–¥–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã–º

### 3.2 Overhead —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

- **CPU:** +2-5% –ø—Ä–∏ 10% sampling
- **Memory:** +50-100MB –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **Network:** ~1KB –Ω–∞ trace, –ø—Ä–∏ 1000 RPS = 100KB/s = 8.6GB/–º–µ—Å—è—Ü

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- Tail-based sampling (–ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏)
- –ë–∞—Ç—á–∏–Ω–≥ span'–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- Compression gRPC —Ç—Ä–∞—Ñ–∏–∫–∞

---

## 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 4.1 –£–≥—Ä–æ–∑—ã

1. **–ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ç—Ä–µ–π—Å–∞–º**
   - –¢—Ä–µ–π—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, ID –∑–∞–∫–∞–∑–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

2. **Injection –∞—Ç–∞–∫–∏ —á–µ—Ä–µ–∑ span attributes**
   - –í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ trace context –º–æ–≥—É—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
   - XSS –≤ Jaeger UI

3. **DoS —á–µ—Ä–µ–∑ —Ñ–ª—É–¥ —Ç—Ä–µ–π—Å–∞–º–∏**
   - –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ Jaeger Collector –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–º–∏ —Ç—Ä–µ–π—Å–∞–º–∏

### 4.2 –ú–µ—Ä—ã –∑–∞—â–∏—Ç—ã

#### 4.2.1 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```yaml
# Jaeger UI –∑–∞ reverse proxy (Nginx)
location /jaeger {
    auth_request /auth;
    proxy_pass http://jaeger-ui:16686;

    # –¢–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    proxy_set_header X-Forwarded-User $remote_user;
}

# –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å
- role: developer
  permissions: [read_traces, search_traces]

- role: sre
  permissions: [read_traces, search_traces, configure_sampling]

- role: auditor
  permissions: [read_traces]
```

#### 4.2.2 –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

```yaml
# TLS –¥–ª—è gRPC collector
jaeger:
  collector:
    grpc:
      tls:
        enabled: true
        cert: /etc/jaeger/tls/server.crt
        key: /etc/jaeger/tls/server.key

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Elasticsearch
elasticsearch:
  xpack:
    security:
      enabled: true
      transport.ssl.enabled: true
```

#### 4.2.3 Sanitization —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```java
// SpringBoot interceptor
@Component
public class TraceSanitizer implements SpanProcessor {

    private static final Set<String> SENSITIVE_KEYS = Set.of(
        "password", "credit_card", "ssn", "token"
    );

    @Override
    public void onStart(Context parentContext, ReadWriteSpan span) {
        span.getAttributes().forEach((key, value) -> {
            if (SENSITIVE_KEYS.contains(key.toLowerCase())) {
                span.setAttribute(key, "[REDACTED]");
            }
        });
    }
}
```

#### 4.2.4 Rate limiting

```yaml
# Jaeger Collector rate limiting
collector:
  grpc:
    max_connections_per_ip: 100
    max_message_size: 4MB

  throttling:
    enabled: true
    max_traces_per_second: 10000
```

#### 4.2.5 Network segmentation

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Application Network (10.0.1.0/24)   ‚îÇ
‚îÇ  - Shop, CRM, MES                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ Port 14250 (gRPC)
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Observability Network (10.0.2.0/24) ‚îÇ
‚îÇ  - Jaeger Collector                  ‚îÇ
‚îÇ  - Elasticsearch                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ Port 16686 (HTTP)
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Management Network (10.0.3.0/24)    ‚îÇ
‚îÇ  - Jaeger UI (—á–µ—Ä–µ–∑ VPN)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Firewall rules:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí Collector: —Ç–æ–ª—å–∫–æ 14250/tcp
- Collector ‚Üí Elasticsearch: —Ç–æ–ª—å–∫–æ 9200/tcp
- Jaeger UI: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ VPN

#### 4.2.6 Audit logging

```yaml
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç—Ä–µ–π—Å–∞–º
jaeger:
  query:
    access_log:
      enabled: true
      path: /var/log/jaeger/access.log
      format: |
        timestamp={{ .Timestamp }}
        user={{ .User }}
        trace_id={{ .TraceID }}
        action={{ .Action }}
        ip={{ .RemoteIP }}
```

---

## 5. Roadmap –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### Phase 1: Pilot (2 –Ω–µ–¥–µ–ª–∏)
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Shop API (SpringBoot)
- –î–µ–ø–ª–æ–π Jaeger (single-node)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤

### Phase 2: Rollout (3 –Ω–µ–¥–µ–ª–∏)
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CRM API –∏ MES API
- Context propagation —á–µ—Ä–µ–∑ RabbitMQ
- Production deployment —Å Elasticsearch backend

### Phase 3: Optimization (2 –Ω–µ–¥–µ–ª–∏)
- Fine-tuning sampling rates
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SLI/SLO –¥–∞—à–±–æ—Ä–¥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å incident management

### Phase 4: Advanced (ongoing)
- Tail-based sampling
- Anomaly detection ML
- Continuous profiling

---

## 6. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –æ–∂–∏–¥–∞–µ–º:

- ‚úÖ **MTTR —Å–æ–∫—Ä–∞—â–∞–µ—Ç—Å—è —Å 2 —á–∞—Å–æ–≤ –¥–æ < 15 –º–∏–Ω—É—Ç**
- ‚úÖ **–í—ã—è–≤–ª–µ–Ω–∏–µ 100% –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ RabbitMQ**
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å 30 –º–∏–Ω—É—Ç –¥–æ < 2 –º–∏–Ω—É—Ç** (–ø–æ—Å–ª–µ –≤—ã—è–≤–ª–µ–Ω–∏—è bottleneck)
- ‚úÖ **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞ MES –Ω–∞ 50%+** (–ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚úÖ **–°–Ω–∏–∂–µ–Ω–∏–µ customer complaints –Ω–∞ 30%** (–±–ª–∞–≥–æ–¥–∞—Ä—è proactive –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É)

---

## 7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í–Ω–µ–¥—Ä–µ–Ω–∏–µ OpenTelemetry + Jaeger –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—Ç" –≤–≤–∏–¥—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ—Ç–µ—Ä–µ–π –∑–∞–∫–∞–∑–æ–≤. –†–µ—à–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

1. **–ü–æ–ª–Ω—É—é –≤–∏–¥–∏–º–æ—Å—Ç—å** –¥–≤–∏–∂–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ Shop ‚Üí RabbitMQ ‚Üí CRM ‚Üí MES
2. **–ë—ã—Å—Ç—Ä—É—é –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é** –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏, –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞)
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** SLI/SLO –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ sanitization –¥–∞–Ω–Ω—ã—Ö

ROI –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –æ–∫—É–ø–∞–µ—Ç—Å—è –∑–∞ –ø–µ—Ä–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª –∑–∞ —Å—á–µ—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è MTTR –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏ –∑–∞–∫–∞–∑–æ–≤.
